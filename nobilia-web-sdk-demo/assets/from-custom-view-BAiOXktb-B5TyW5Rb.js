import{a as e,n as t}from"./index-CYoHV6Dr.js";import{c as n,l as r,u as i}from"./embedding-plugins-CjNos83d-BN30irnf.js";import{a,i as o,n as s,r as c,t as l}from"./touch-drag-DWISKgWm-DH1u90nx.js";var u=e=>`[data-rml-custom-view="${e}"]`,d=e=>{e.preventDefault(),e.stopPropagation()},f=(e,t,n,r)=>{let i=n-e,a=r-t;return Math.sqrt(i*i+a*a)},p=class{_startX=0;_startY=0;_lastX=0;_lastY=0;_epsilon;_isWaiting=!1;_onCustomDragStart;constructor({onCustomDragStart:e},t={}){this._epsilon=typeof t.epsilon==`number`?t.epsilon:15,this._onCustomDragStart=e}onMove(e){this._lastX=e.clientX,this._lastY=e.clientY,this._isWaiting&&f(this._startX,this._startY,this._lastX,this._lastY)>this._epsilon&&(this._onCustomDragStart(e),this._isWaiting=!1)}onStart(e){this._startX=e.clientX,this._startY=e.clientY,this.onMove(e),this._isWaiting=!0}onEnd(){this._reset()}_reset(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._isWaiting=!1}},m=`data-rml-old-draggable`,h=void 0,g=(e,n)=>{let r=t(e),i={delay:r?500:100,epsilon:r?10:15};if(!n)return i;if(!r&&!(e instanceof MouseEvent))return console.warn(`Unsupported event! It is not TouchEvent and also not MouseEvent`),i;let{delayKey:a,epsilonKey:o}=r?{delayKey:`touchDragDelay`,epsilonKey:`touchDragEpsilon`}:{delayKey:`customDragDelay`,epsilonKey:`customDragEpsilon`};return typeof n[a]==`number`&&(i.delay=n.touchDragDelay),typeof n[o]==`number`&&(i.epsilon=n.touchDragEpsilon),i},_=e=>{let t=``,r=112,i=112;if(!e)return{url:n,width:r,height:i};let a=e;if(a instanceof HTMLElement){let e=a.getBoundingClientRect(),o=a.getAttribute(`data-rml-ghost-url`),s=a.getAttribute(`data-rml-ghost-width`),c=a.getAttribute(`data-rml-ghost-height`);o?t=o:!o&&a instanceof HTMLImageElement&&a.src&&(t=a.src),t?(r=e.width,i=e.height):t=n,r=s?parseInt(s,10):r,i=c?parseInt(c,10):i}return{url:t||`https://res.cloudinary.com/roomle/image/upload/v1729679975/fallback_afpyqr.jpg`,width:r,height:i}},v=class{_options={};_instance;_mainDomElement;_viewName;_currentCustomDrag=null;_currentBb=null;_startTarget=null;_onBeforeUpdateDrag=()=>({});isDragging=!1;constructor(e,t,n,r){this._instance=e,this._options=n||{},this._viewName=r,this._mainDomElement=t,this._mainDomElement.parentElement?.addEventListener(`dragleave`,()=>{this._instance.cancelDragIn()})}beforeUpdateGhost(e){this._onBeforeUpdateDrag=e}async _dragStart(t,n,r=`rml_id`){this._startTarget&&(this._startTarget.style.pointerEvents=`none`,this._startTarget.style.userSelect=`none`,this._startTarget.setAttribute(m,this._startTarget.draggable.toString()),this._startTarget.draggable=!1,this._startTarget.removeEventListener(`dragstart`,d),this._startTarget.addEventListener(`dragstart`,d)),this._currentBb=await this._instance.getBoundingClientRect(u(this._viewName));let{clientX:i,clientY:a}=e(n),o=this._currentBb.x+i,s=this._currentBb.y+a;this.isDragging=!0,this._instance.dragInObject(t,o,s,r)}_dragUpdate(t){if(document.body.focus(),this._currentCustomDrag&&this._currentCustomDrag.onMove(t),!this._currentBb||!this.isDragging)return;let{clientX:n,clientY:r}=e(t),{url:i,width:a,height:o}=_(this._startTarget),s=this._currentBb.x+n,c=this._currentBb.y+r,l=this._options||{},u={ghost:{visibleIn:{x:this._currentBb.x-(l.dragInOverlapX||0),y:this._currentBb.y+(l.dragInOverlapY||0),width:this._currentBb.width+(l.dragInOverlapX||0),height:this._currentBb.height+(l.dragInOverlapY||0)},url:i,width:a,height:o},mode:`custom-view`},{x:d,y:f,options:p}=this._onBeforeUpdateDrag(s,c,u),m=typeof d==`number`?d:s,h=typeof f==`number`?f:c,g=p||u;this._instance.updateDrag(m,h,g)}_dragEnd(){this._currentCustomDrag&&this._currentCustomDrag.onEnd(),this._currentCustomDrag=null,this.isDragging=!1,this._currentBb=null,this._resetStartTarget(),this._instance.enableEvents(),this._instance.dragInObjectEnd()}dragStart(e,n,r){this._instance.disableEvents(),this._startTarget=n.target,this._currentCustomDrag=t(n)?new c(h,{onTouchDragStart:(t,n)=>{this._dragStart(e,n,r)}},g(n,this._options)):new p({onCustomDragStart:t=>this._dragStart(e,t,r)},g(n,this._options)),this._currentCustomDrag.onStart(n)}dragEnd(){this._dragEnd()}dragUpdate(e){this._dragUpdate(e)}touchStart(e,t,n=`rml_id`){this.dragStart(e,t,n)}touchMove(e){this.dragUpdate(e)}touchEnd(){this.dragEnd()}dispose(){}_resetStartTarget(){this._startTarget&&(this._startTarget.style.pointerEvents=``,this._startTarget.style.userSelect=``,this._startTarget.draggable=this._startTarget.getAttribute(m)===`true`,this._startTarget.removeAttribute(m),this._startTarget.removeEventListener(`dragstart`,d))}releaseInput(e){this._currentCustomDrag&&this._currentCustomDrag.onEnd(),this._resetStartTarget()}};export{v as DragInFromCustomViewStrategy};