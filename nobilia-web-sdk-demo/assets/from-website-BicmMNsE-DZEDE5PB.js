import{l as S,x as D,a as y,C as T}from"./index-HBOre6Jx.js";import{n as R}from"./touch-drag-DWISKgWm-uNTYJmFJ.js";import{i as p,j as v,k as B,R as m,a as x,b as C,c as P,d as $,e as G,f as F,g as I,h as E}from"./embedding-plugins-CjNos83d-CSux-1Eq.js";const b=(o,n,t=0,e=0)=>{const s=n.x+n.width+t,i=n.x-t,r=n.y+n.height+e,a=n.y-e,{x:h,y:g}=o;return h>=i&&h<=s&&g>=a&&g<=r},A=(o,n,t,e=0,s=0)=>{if(!(!t||!t.hiddenIn&&!t.visibleIn))return t.visibleIn?b({x:o,y:n},t.visibleIn,e,s):t.hiddenIn?!b({x:o,y:n},t.hiddenIn,-e,-s):!1},L=()=>{if(!document.getElementById(x)){const o=document.createElement("style");o.type="text/css",o.id=x,o.innerHTML=`
    ${C}
    ${P}
  `,document.head.appendChild(o)}},M=({x:o,y:n},t)=>{let e=document.getElementById(m);if(!e){if(e=document.createElement("div"),t.ghost?.element)e.appendChild(t.ghost.element);else{const s=document.createElement("img");s.src=t.ghost?.url||$,s.width=t.ghost?.width||G,s.height=t.ghost?.height||F,e.appendChild(s)}e.id=m,e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.willChange="transform",e.style.transform="translate3d(0, 0, 0)",e.style.zIndex="9999",e.style.opacity="0.5",A(o,n,t.ghost||{},t.settings?.dragInOverlapX,t.settings?.dragInOverlapY)||(e.style.display="none"),e.style.pointerEvents="none",document.body.appendChild(e)}},N=({x:o,y:n},t)=>{const e=document.getElementById(m);if(!e)return;let s=t.ghost?.width,i=t.ghost?.height;typeof s>"u"&&(s=e.getBoundingClientRect().width||G),typeof i>"u"&&(i=e.getBoundingClientRect().height||F);const r=o-s/2,a=n-i/2;e.style.transform=`translate3d(${r}px, ${a}px, 0)`,t.ghost&&(A(o,n,t.ghost,t.settings?.dragInOverlapX,t.settings?.dragInOverlapY)?e.style.animation!=I&&(e.style.animation=I):e.style.animation!=E&&(e.style.animation=E))};class O{_dragGhostAnimationFrameId=null;_dragGhostRemoveAnimationFrameId=null;_dragGhostElement=null;constructor(n=null){this._dragGhostElement=n}updateDragGhost(n,t,e){this._dragGhostRemoveAnimationFrameId&&(cancelAnimationFrame(this._dragGhostRemoveAnimationFrameId),this._dragGhostRemoveAnimationFrameId=null),!e.ghost?.external&&e.ghost&&(this._dragGhostAnimationFrameId||(this._dragGhostAnimationFrameId=requestAnimationFrame(()=>{L();const s={x:n,y:t};!e.ghost&&this._dragGhostElement&&(e.ghost={}),e.ghost&&!e.ghost.element&&this._dragGhostElement&&(e.ghost.element=this._dragGhostElement),M(s,e),N(s,e),this._dragGhostAnimationFrameId=null})))}removeDragGhost(){this._dragGhostAnimationFrameId&&(cancelAnimationFrame(this._dragGhostAnimationFrameId),this._dragGhostAnimationFrameId=null),this._dragGhostRemoveAnimationFrameId||(this._dragGhostRemoveAnimationFrameId=requestAnimationFrame(()=>{const n=document.getElementById(m);n&&document.body.removeChild(n),this._dragGhostRemoveAnimationFrameId=null}))}}class q{_options={};_instance;_mainDomElement;_currentDrag={};_currentTouch=null;_firefoxDragPosition={x:0,y:0};_onBeforeUpdateDrag=()=>({});isDragging=!1;_firefoxFallback=n=>{if(!this._currentDrag.event)return;n.preventDefault();const t=n||window.event;this._firefoxDragPosition.x=t.pageX||0,this._firefoxDragPosition.y=t.pageY||0};constructor(n,t,e){this._instance=n,this._mainDomElement=t,this._options=e||{},this._firefoxFallback=this._firefoxFallback.bind(this),document.addEventListener("dragover",this._firefoxFallback),this._mainDomElement.parentElement?.addEventListener("dragleave",()=>{this._instance.cancelDragIn()})}beforeUpdateGhost(n){this._onBeforeUpdateDrag=n}dragStart(n,t,e="rml_id"){const s=this._mainDomElement.parentNode;if(S(s).position!=="relative"){console.warn("Parent of iframe should have position relative, otherwise drag-in can not detect the x/y coordinates correctly");return}this._mainDomElement.style.pointerEvents="none";let i=s.querySelector("."+p);i||(i=document.createElement("div"),i.classList.add(p),s.appendChild(i)),i.classList.remove(v.DISPLAY_NONE),t.target.getAttribute("draggable")||console.warn(`Draggable not detected correctly! Did you add draggable="true" to the element? In Sarafi only 'draggable' is too less`);const r=s.querySelector("."+B);this._currentDrag.event=t;const a=t.target,h=a.cloneNode(!0),g=a.getBoundingClientRect();h.style.width=`${g.width}px`,h.style.height=`${g.height}px`,this._currentDrag.ghost=new O(h),this._currentDrag.offset||(this._currentDrag.offset={x:0,y:0});const{clientX:c,clientY:u}=D(t,this._firefoxDragPosition);this._currentDrag.offset.x=c-g.left,this._currentDrag.offset.y=u-g.top,t instanceof DragEvent&&t.dataTransfer&&t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(r,0,0);const{x:d,y:_}=y(s,this._currentDrag.event||t,this._firefoxDragPosition),f=Math.max(1,d),l=Math.max(1,_);this.isDragging=!0,this._instance.dragInObject(n,f,l,e)}dragUpdate(n){const t=this._mainDomElement.parentNode,{x:e,y:s}=y(t,n,this._firefoxDragPosition);if(e===0&&s===0)return;const i=Math.max(1,e),r=Math.max(1,s);if(i===1&&r===1)return;let a=i,h=r;if(T(n)){const l=this._options.settings?.fingerSize||0;a=Math.max(2,i+l),h=Math.max(2,r-l)}const{x:g,y:c,options:u}=this._onBeforeUpdateDrag(a,h,{}),d=u||{settings:{},ghost:{}};d.ghost||(d.ghost={}),d.ghost.visibleIn&&d.ghost.hiddenIn||(d.ghost.hiddenIn=this._mainDomElement.getBoundingClientRect());const _=typeof g=="number"?g:a,f=typeof c=="number"?c:h;if(this._currentDrag.ghost){const{clientX:l,clientY:w}=D(n,this._firefoxDragPosition);this._currentDrag.ghost.updateDragGhost(l,w,d)}this._instance.updateDrag(_,f,{})}dragEnd(){this._mainDomElement.style.pointerEvents="all";const n=this._mainDomElement.parentNode;this.isDragging=!1,this._instance.dragInObjectEnd(),this._currentDrag.ghost&&(this._currentDrag.ghost.removeDragGhost(),this._currentDrag.ghost=null),this._currentDrag={},this._firefoxDragPosition={x:0,y:0};const t=n.querySelector("."+p);t&&t.classList.add(v.DISPLAY_NONE)}touchStart(n,t,e="rml_id"){t.preventDefault();const s=(r,a)=>{this.dragStart(n,a,e)},i={};typeof this._options?.settings?.touchDragDelay=="number"&&(i.delay=this._options.settings.touchDragDelay),this._options?.settings?.touchDragEpsilon&&(i.epsilon=this._options.settings.touchDragEpsilon),this._currentTouch=new R(void 0,{onTouchDragStart:s},i),this._currentTouch.onStart(t)}touchMove(n){this._currentTouch&&this._currentTouch.onMove(n),this._currentDrag.event&&this.dragUpdate(n)}touchEnd(){this._currentTouch&&this._currentTouch.onEnd(),this._currentTouch=null,this.dragEnd()}dispose(){document.removeEventListener("dragover",this._firefoxFallback)}releaseInput(n){}}export{q as DragInFromWebsiteStrategy};
