import{X as p,O as S,r as b,E as v,f as w,m as C,Y as B}from"./touch-drag-DXJTOrk5-BxKVs6bP.js";import{f as X,e as Y,d as _}from"./drag-in-DuufO5eB-C5ZFr0aN.js";import"./index-d3xgJwxe.js";const I=a=>`[data-rml-custom-view="${a}"]`,l=a=>{a.preventDefault(),a.stopPropagation()},M=(a,t,e,r)=>{const s=e-a,i=r-t;return Math.sqrt(s*s+i*i)};class U{_startX=0;_startY=0;_lastX=0;_lastY=0;_epsilon;_isWaiting=!1;_onCustomDragStart;constructor({onCustomDragStart:t},e={}){this._epsilon=typeof e.epsilon=="number"?e.epsilon:v,this._onCustomDragStart=t}onMove(t){this._lastX=t.clientX,this._lastY=t.clientY,this._isWaiting&&M(this._startX,this._startY,this._lastX,this._lastY)>this._epsilon&&(this._onCustomDragStart(t),this._isWaiting=!1)}onStart(t){this._startX=t.clientX,this._startY=t.clientY,this.onMove(t),this._isWaiting=!0}onEnd(){this._reset()}_reset(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._isWaiting=!1}}const u="data-rml-old-draggable",L=void 0,D=(a,t)=>{const e=b(a),r={delay:e?C:B,epsilon:e?w:v};if(!t)return r;if(!e&&!(a instanceof MouseEvent))return console.warn("Unsupported event! It is not TouchEvent and also not MouseEvent"),r;const{delayKey:s,epsilonKey:i}=e?{delayKey:"touchDragDelay",epsilonKey:"touchDragEpsilon"}:{delayKey:"customDragDelay",epsilonKey:"customDragEpsilon"};return typeof t[s]=="number"&&(r.delay=t.touchDragDelay),typeof t[i]=="number"&&(r.epsilon=t.touchDragEpsilon),r},O=a=>{let t="",e=Y,r=X;if(!a)return{url:_,width:e,height:r};const s=a;if(s instanceof HTMLElement){const i=s.getBoundingClientRect(),n=s.getAttribute("data-rml-ghost-url"),o=s.getAttribute("data-rml-ghost-width"),h=s.getAttribute("data-rml-ghost-height");n?t=n:!n&&s instanceof HTMLImageElement&&s.src&&(t=s.src),t?(e=i.width,r=i.height):t=_,e=o?parseInt(o,10):e,r=h?parseInt(h,10):r}return{url:t||_,width:e,height:r}};class ${_options={};_instance;_mainDomElement;_viewName;_currentCustomDrag=null;_currentBb=null;_startTarget=null;_onBeforeUpdateDrag=()=>({});isDragging=!1;constructor(t,e,r){this._instance=t,this._options=e||{},this._viewName=r,this._mainDomElement=mainDomElement,this._mainDomElement.parentElement?.addEventListener("dragleave",()=>{this._instance.cancelDragIn()})}beforeUpdateGhost(t){this._onBeforeUpdateDrag=t}async _dragStart(t,e,r="rml_id"){this._startTarget&&(this._startTarget.style.pointerEvents="none",this._startTarget.style.userSelect="none",this._startTarget.setAttribute(u,this._startTarget.draggable.toString()),this._startTarget.draggable=!1,this._startTarget.removeEventListener("dragstart",l),this._startTarget.addEventListener("dragstart",l)),this._currentBb=await this._instance.getBoundingClientRect(I(this._viewName));const{clientX:s,clientY:i}=p(e),n=this._currentBb.x+s,o=this._currentBb.y+i;this.isDragging=!0,this._instance.dragInObject(t,n,o,r)}_dragUpdate(t){if(document.body.focus(),this._currentCustomDrag&&this._currentCustomDrag.onMove(t),!this._currentBb||!this.isDragging)return;const{clientX:e,clientY:r}=p(t),{url:s,width:i,height:n}=O(this._startTarget),o=this._currentBb.x+e,h=this._currentBb.y+r,g=this._options||{},c={ghost:{visibleIn:{x:this._currentBb.x-(g.dragInOverlapX||0),y:this._currentBb.y+(g.dragInOverlapY||0),width:this._currentBb.width+(g.dragInOverlapX||0),height:this._currentBb.height+(g.dragInOverlapY||0)},url:s,width:i,height:n},mode:"custom-view"},{x:d,y:m,options:y}=this._onBeforeUpdateDrag(o,h,c),E=typeof d=="number"?d:o,f=typeof m=="number"?m:h,T=y||c;this._instance.updateDrag(E,f,T)}_dragEnd(){this._currentCustomDrag&&this._currentCustomDrag.onEnd(),this._currentCustomDrag=null,this.isDragging=!1,this._currentBb=null,this._resetStartTarget(),this._instance.enableEvents(),this._instance.dragInObjectEnd()}dragStart(t,e,r){this._instance.disableEvents(),this._startTarget=e.target;const s=(i,n)=>{this._dragStart(t,n,r)};this._currentCustomDrag=b(e)?new S(L,{onTouchDragStart:s},D(e,this._options)):new U({onCustomDragStart:i=>this._dragStart(t,i,r)},D(e,this._options)),this._currentCustomDrag.onStart(e)}dragEnd(){this._dragEnd()}dragUpdate(t){this._dragUpdate(t)}touchStart(t,e,r="rml_id"){this.dragStart(t,e,r)}touchMove(t){this.dragUpdate(t)}touchEnd(){this.dragEnd()}dispose(){}_resetStartTarget(){this._startTarget&&(this._startTarget.style.pointerEvents="",this._startTarget.style.userSelect="",this._startTarget.draggable=this._startTarget.getAttribute(u)==="true",this._startTarget.removeAttribute(u),this._startTarget.removeEventListener("dragstart",l))}releaseInput(t){this._currentCustomDrag&&this._currentCustomDrag.onEnd(),this._resetStartTarget()}}export{$ as DragInFromCustomViewStrategy};
