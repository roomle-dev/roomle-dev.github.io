import{a as e,c as t,d as n,f as r,i,l as a,n as o,o as s,p as c,s as l,t as u,u as d}from"./drag-in-BEjBh6zz-CPBdyov_.js";import{c as f,i as p,l as m,r as h,t as g}from"./touch-drag-DXJTOrk5-DnXJwjxN.js";var _=(e,t,n=0,r=0)=>{let i=t.x+t.width+n,a=t.x-n,o=t.y+t.height+r,s=t.y-r,{x:c,y:l}=e;return c>=a&&c<=i&&l>=s&&l<=o},v=(e,t,n,r=0,i=0)=>{if(!(!n||!n.hiddenIn&&!n.visibleIn))return n.visibleIn?_({x:e,y:t},n.visibleIn,r,i):n.hiddenIn?!_({x:e,y:t},n.hiddenIn,-r,-i):!1},y=()=>{if(!document.getElementById(`rml-drag-in-styles`)){let e=document.createElement(`style`);e.type=`text/css`,e.id=d,e.innerHTML=`
    ${s}
    ${o}
  `,document.head.appendChild(e)}},b=({x:e,y:t},n)=>{let r=document.getElementById(i);if(!r){if(r=document.createElement(`div`),n.ghost?.element)r.appendChild(n.ghost.element);else{let e=document.createElement(`img`);e.src=n.ghost?.url||`https://res.cloudinary.com/roomle/image/upload/v1729679975/fallback_afpyqr.jpg`,e.width=n.ghost?.width||112,e.height=n.ghost?.height||112,r.appendChild(e)}r.id=i,r.style.position=`fixed`,r.style.top=`0`,r.style.left=`0`,r.style.willChange=`transform`,r.style.transform=`translate3d(0, 0, 0)`,r.style.zIndex=`9999`,r.style.opacity=`0.5`,v(e,t,n.ghost||{},n.settings?.dragInOverlapX,n.settings?.dragInOverlapY)||(r.style.display=`none`),r.style.pointerEvents=`none`,document.body.appendChild(r)}},x=({x:t,y:n},r)=>{let a=document.getElementById(i);if(!a)return;let o=r.ghost?.width,s=r.ghost?.height;typeof o>`u`&&(o=a.getBoundingClientRect().width||112),typeof s>`u`&&(s=a.getBoundingClientRect().height||112);let c=t-o/2,l=n-s/2;a.style.transform=`translate3d(${c}px, ${l}px, 0)`,r.ghost&&(v(t,n,r.ghost,r.settings?.dragInOverlapX,r.settings?.dragInOverlapY)?a.style.animation!=e&&(a.style.animation=e):a.style.animation!=u&&(a.style.animation=u))},S=class{_dragGhostAnimationFrameId=null;_dragGhostRemoveAnimationFrameId=null;_dragGhostElement=null;constructor(e=null){this._dragGhostElement=e}updateDragGhost(e,t,n){this._dragGhostRemoveAnimationFrameId&&=(cancelAnimationFrame(this._dragGhostRemoveAnimationFrameId),null),!n.ghost?.external&&n.ghost&&(this._dragGhostAnimationFrameId||=requestAnimationFrame(()=>{y();let r={x:e,y:t};!n.ghost&&this._dragGhostElement&&(n.ghost={}),n.ghost&&!n.ghost.element&&this._dragGhostElement&&(n.ghost.element=this._dragGhostElement),b(r,n),x(r,n),this._dragGhostAnimationFrameId=null}))}removeDragGhost(){this._dragGhostAnimationFrameId&&=(cancelAnimationFrame(this._dragGhostAnimationFrameId),null),this._dragGhostRemoveAnimationFrameId||=requestAnimationFrame(()=>{let e=document.getElementById(`rml-drag-in-drag-element`);e&&document.body.removeChild(e),this._dragGhostRemoveAnimationFrameId=null})}},C=class{_options={};_instance;_mainDomElement;_currentDrag={};_currentTouch=null;_firefoxDragPosition={x:0,y:0};_onBeforeUpdateDrag=()=>({});isDragging=!1;_firefoxFallback=e=>{if(!this._currentDrag.event)return;e.preventDefault();let t=e||window.event;this._firefoxDragPosition.x=t.pageX||0,this._firefoxDragPosition.y=t.pageY||0};constructor(e,t,n){this._instance=e,this._mainDomElement=t,this._options=n||{},this._firefoxFallback=this._firefoxFallback.bind(this),document.addEventListener(`dragover`,this._firefoxFallback),this._mainDomElement.parentElement?.addEventListener(`dragleave`,()=>{this._instance.cancelDragIn()})}beforeUpdateGhost(e){this._onBeforeUpdateDrag=e}dragStart(e,t,i=`rml_id`){let a=this._mainDomElement.parentNode;if(m(a).position!==`relative`){console.warn(`Parent of iframe should have position relative, otherwise drag-in can not detect the x/y coordinates correctly`);return}this._mainDomElement.style.pointerEvents=`none`;let o=a.querySelector(`.`+c);o||(o=document.createElement(`div`),o.classList.add(`rml-drag-in-overlay`),a.appendChild(o)),o.classList.remove(r.DISPLAY_NONE),t.target.getAttribute(`draggable`)||console.warn(`Draggable not detected correctly! Did you add draggable="true" to the element? In Sarafi only 'draggable' is too less`);let s=a.querySelector(`.`+n);this._currentDrag.event=t;let l=t.target,u=l.cloneNode(!0),d=l.getBoundingClientRect();u.style.width=`${d.width}px`,u.style.height=`${d.height}px`,this._currentDrag.ghost=new S(u),this._currentDrag.offset||(this._currentDrag.offset={x:0,y:0});let{clientX:f,clientY:h}=p(t,this._firefoxDragPosition);this._currentDrag.offset.x=f-d.left,this._currentDrag.offset.y=h-d.top,t instanceof DragEvent&&t.dataTransfer&&t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(s,0,0);let{x:_,y:v}=g(a,this._currentDrag.event||t,this._firefoxDragPosition),y=Math.max(1,_),b=Math.max(1,v);this.isDragging=!0,this._instance.dragInObject(e,y,b,i)}dragUpdate(e){let t=this._mainDomElement.parentNode,{x:n,y:r}=g(t,e,this._firefoxDragPosition);if(n===0&&r===0)return;let i=Math.max(1,n),a=Math.max(1,r);if(i===1&&a===1)return;let o=i,s=a;if(f(e)){let e=this._options.settings?.fingerSize||0;o=Math.max(2,i+e),s=Math.max(2,a-e)}let{x:c,y:l,options:u}=this._onBeforeUpdateDrag(o,s,{}),d=u||{settings:{},ghost:{}};d.ghost||={},d.ghost.visibleIn&&d.ghost.hiddenIn||(d.ghost.hiddenIn=this._mainDomElement.getBoundingClientRect());let m=typeof c==`number`?c:o,h=typeof l==`number`?l:s;if(this._currentDrag.ghost){let{clientX:t,clientY:n}=p(e,this._firefoxDragPosition);this._currentDrag.ghost.updateDragGhost(t,n,d)}this._instance.updateDrag(m,h,{})}dragEnd(){this._mainDomElement.style.pointerEvents=`all`;let e=this._mainDomElement.parentNode;this.isDragging=!1,this._instance.dragInObjectEnd(),this._currentDrag.ghost&&(this._currentDrag.ghost.removeDragGhost(),this._currentDrag.ghost=null),this._currentDrag={},this._firefoxDragPosition={x:0,y:0};let t=e.querySelector(`.`+c);t&&t.classList.add(r.DISPLAY_NONE)}touchStart(e,t,n=`rml_id`){t.preventDefault();let r=(t,r)=>{this.dragStart(e,r,n)},i={};typeof this._options?.settings?.touchDragDelay==`number`&&(i.delay=this._options.settings.touchDragDelay),this._options?.settings?.touchDragEpsilon&&(i.epsilon=this._options.settings.touchDragEpsilon),this._currentTouch=new h(void 0,{onTouchDragStart:r},i),this._currentTouch.onStart(t)}touchMove(e){this._currentTouch&&this._currentTouch.onMove(e),this._currentDrag.event&&this.dragUpdate(e)}touchEnd(){this._currentTouch&&this._currentTouch.onEnd(),this._currentTouch=null,this.dragEnd()}dispose(){document.removeEventListener(`dragover`,this._firefoxFallback)}releaseInput(e){}};export{C as DragInFromWebsiteStrategy};