import{a as e,i as t,n,r}from"./index-CYoHV6Dr.js";import{a as i,c as a,d as o,f as s,l as c,m as l,o as u,p as d,r as f,s as p,t as m,u as h}from"./embedding-plugins-CjNos83d-BN30irnf.js";import{r as g}from"./touch-drag-DWISKgWm-DH1u90nx.js";var _=(e,t,n=0,r=0)=>{let i=t.x+t.width+n,a=t.x-n,o=t.y+t.height+r,s=t.y-r,{x:c,y:l}=e;return c>=a&&c<=i&&l>=s&&l<=o},v=(e,t,n,r=0,i=0)=>{if(!(!n||!n.hiddenIn&&!n.visibleIn))return n.visibleIn?_({x:e,y:t},n.visibleIn,r,i):n.hiddenIn?!_({x:e,y:t},n.hiddenIn,-r,-i):!1},y=()=>{if(!document.getElementById(`rml-drag-in-styles`)){let e=document.createElement(`style`);e.type=`text/css`,e.id=o,e.innerHTML=`
    ${d}
    ${p}
  `,document.head.appendChild(e)}},b=({x:e,y:t},n)=>{let r=document.getElementById(i);if(!r){if(r=document.createElement(`div`),n.ghost?.element)r.appendChild(n.ghost.element);else{let e=document.createElement(`img`);e.src=n.ghost?.url||`https://res.cloudinary.com/roomle/image/upload/v1729679975/fallback_afpyqr.jpg`,e.width=n.ghost?.width||112,e.height=n.ghost?.height||112,r.appendChild(e)}r.id=i,r.style.position=`fixed`,r.style.top=`0`,r.style.left=`0`,r.style.willChange=`transform`,r.style.transform=`translate3d(0, 0, 0)`,r.style.zIndex=`9999`,r.style.opacity=`0.5`,v(e,t,n.ghost||{},n.settings?.dragInOverlapX,n.settings?.dragInOverlapY)||(r.style.display=`none`),r.style.pointerEvents=`none`,document.body.appendChild(r)}},x=({x:e,y:t},n)=>{let r=document.getElementById(i);if(!r)return;let a=n.ghost?.width,o=n.ghost?.height;typeof a>`u`&&(a=r.getBoundingClientRect().width||112),typeof o>`u`&&(o=r.getBoundingClientRect().height||112);let s=e-a/2,c=t-o/2;r.style.transform=`translate3d(${s}px, ${c}px, 0)`,n.ghost&&(v(e,t,n.ghost,n.settings?.dragInOverlapX,n.settings?.dragInOverlapY)?r.style.animation!=u&&(r.style.animation=u):r.style.animation!=f&&(r.style.animation=f))},S=class{_dragGhostAnimationFrameId=null;_dragGhostRemoveAnimationFrameId=null;_dragGhostElement=null;constructor(e=null){this._dragGhostElement=e}updateDragGhost(e,t,n){this._dragGhostRemoveAnimationFrameId&&=(cancelAnimationFrame(this._dragGhostRemoveAnimationFrameId),null),!n.ghost?.external&&n.ghost&&(this._dragGhostAnimationFrameId||=requestAnimationFrame(()=>{y();let r={x:e,y:t};!n.ghost&&this._dragGhostElement&&(n.ghost={}),n.ghost&&!n.ghost.element&&this._dragGhostElement&&(n.ghost.element=this._dragGhostElement),b(r,n),x(r,n),this._dragGhostAnimationFrameId=null}))}removeDragGhost(){this._dragGhostAnimationFrameId&&=(cancelAnimationFrame(this._dragGhostAnimationFrameId),null),this._dragGhostRemoveAnimationFrameId||=requestAnimationFrame(()=>{let e=document.getElementById(`rml-drag-in-drag-element`);e&&document.body.removeChild(e),this._dragGhostRemoveAnimationFrameId=null})}},C=class{_options={};_instance;_mainDomElement;_currentDrag={};_currentTouch=null;_firefoxDragPosition={x:0,y:0};_onBeforeUpdateDrag=()=>({});isDragging=!1;_firefoxFallback=e=>{if(!this._currentDrag.event)return;e.preventDefault();let t=e||window.event;this._firefoxDragPosition.x=t.pageX||0,this._firefoxDragPosition.y=t.pageY||0};constructor(e,t,n){this._instance=e,this._mainDomElement=t,this._options=n||{},this._firefoxFallback=this._firefoxFallback.bind(this),document.addEventListener(`dragover`,this._firefoxFallback),this._mainDomElement.parentElement?.addEventListener(`dragleave`,()=>{this._instance.cancelDragIn()})}beforeUpdateGhost(e){this._onBeforeUpdateDrag=e}dragStart(n,i,a=`rml_id`){let o=this._mainDomElement.parentNode;if(t(o).position!==`relative`){console.warn(`Parent of iframe should have position relative, otherwise drag-in can not detect the x/y coordinates correctly`);return}this._mainDomElement.style.pointerEvents=`none`;let c=o.querySelector(`.`+m);c||(c=document.createElement(`div`),c.classList.add(`rml-drag-in-overlay`),o.appendChild(c)),c.classList.remove(l.DISPLAY_NONE),i.target.getAttribute(`draggable`)||console.warn(`Draggable not detected correctly! Did you add draggable="true" to the element? In Sarafi only 'draggable' is too less`);let u=o.querySelector(`.`+s);this._currentDrag.event=i;let d=i.target,f=d.cloneNode(!0),p=d.getBoundingClientRect();f.style.width=`${p.width}px`,f.style.height=`${p.height}px`,this._currentDrag.ghost=new S(f),this._currentDrag.offset||(this._currentDrag.offset={x:0,y:0});let{clientX:h,clientY:g}=e(i,this._firefoxDragPosition);this._currentDrag.offset.x=h-p.left,this._currentDrag.offset.y=g-p.top,i instanceof DragEvent&&i.dataTransfer&&i.dataTransfer.setDragImage&&i.dataTransfer.setDragImage(u,0,0);let{x:_,y:v}=r(o,this._currentDrag.event||i,this._firefoxDragPosition),y=Math.max(1,_),b=Math.max(1,v);this.isDragging=!0,this._instance.dragInObject(n,y,b,a)}dragUpdate(t){let i=this._mainDomElement.parentNode,{x:a,y:o}=r(i,t,this._firefoxDragPosition);if(a===0&&o===0)return;let s=Math.max(1,a),c=Math.max(1,o);if(s===1&&c===1)return;let l=s,u=c;if(n(t)){let e=this._options.settings?.fingerSize||0;l=Math.max(2,s+e),u=Math.max(2,c-e)}let{x:d,y:f,options:p}=this._onBeforeUpdateDrag(l,u,{}),m=p||{settings:{},ghost:{}};m.ghost||={},m.ghost.visibleIn&&m.ghost.hiddenIn||(m.ghost.hiddenIn=this._mainDomElement.getBoundingClientRect());let h=typeof d==`number`?d:l,g=typeof f==`number`?f:u;if(this._currentDrag.ghost){let{clientX:n,clientY:r}=e(t,this._firefoxDragPosition);this._currentDrag.ghost.updateDragGhost(n,r,m)}this._instance.updateDrag(h,g,{})}dragEnd(){this._mainDomElement.style.pointerEvents=`all`;let e=this._mainDomElement.parentNode;this.isDragging=!1,this._instance.dragInObjectEnd(),this._currentDrag.ghost&&(this._currentDrag.ghost.removeDragGhost(),this._currentDrag.ghost=null),this._currentDrag={},this._firefoxDragPosition={x:0,y:0};let t=e.querySelector(`.`+m);t&&t.classList.add(l.DISPLAY_NONE)}touchStart(e,t,n=`rml_id`){t.preventDefault();let r=(t,r)=>{this.dragStart(e,r,n)},i={};typeof this._options?.settings?.touchDragDelay==`number`&&(i.delay=this._options.settings.touchDragDelay),this._options?.settings?.touchDragEpsilon&&(i.epsilon=this._options.settings.touchDragEpsilon),this._currentTouch=new g(void 0,{onTouchDragStart:r},i),this._currentTouch.onStart(t)}touchMove(e){this._currentTouch&&this._currentTouch.onMove(e),this._currentDrag.event&&this.dragUpdate(e)}touchEnd(){this._currentTouch&&this._currentTouch.onEnd(),this._currentTouch=null,this.dragEnd()}dispose(){document.removeEventListener(`dragover`,this._firefoxFallback)}releaseInput(e){}};export{C as DragInFromWebsiteStrategy};