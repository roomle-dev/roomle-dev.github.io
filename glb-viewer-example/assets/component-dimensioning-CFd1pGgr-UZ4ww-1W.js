import{Dt as e,F as t,Ki as n,M as r,Mn as i,Pr as a,Rt as o,_t as s,ar as c,di as l,ha as u,j as d,li as f,nt as p,ri as m,tn as h,ut as g,vr as _,xr as v}from"./index-BKXh1dA6.js";var y=class extends m{constructor(e,t={}){let n=t.font;if(n===void 0)super();else{let r=n.generateShapes(e,t.size);t.depth===void 0&&(t.depth=50),t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(r,t)}this.type=`TextGeometry`}},b=Object.defineProperty,x=(e,t,n,r)=>{for(var i=void 0,a=e.length-1,o;a>=0;a--)(o=e[a])&&(i=o(t,n,i)||i);return i&&b(t,n,i),i},S=`component_dimensioning_line_material`,C=`component_dimensioning_plane_material`,w=`component_dimensioning_text_material`,T=.02,E=.025,D=3618615,O=16777215,k=.05,A=class e{constructor(t,n,r){this._direction=e._getDirection(t);let i=e._getDefaultLabelDirection(t,this._direction),a=r.dot(i)>=0;this._labelDirection=e._calculateActualLabelDirection(t,a,i),this._origin=e._calculateOrigin(t,n,a)}get direction(){return this._direction}get labelDirection(){return this._labelDirection}getEdge(e,t,n){return new r(this._origin.clone().add(this._direction.clone().multiplyScalar(e)).add(this._labelDirection.clone().multiplyScalar(n)),this._origin.clone().add(this._direction.clone().multiplyScalar(t)).add(this._labelDirection.clone().multiplyScalar(n)))}static _getDirection(e){return e.axis?v(e.axis.direction).normalize():e.dimensioning.axis===`x`?new h(1,0,0):e.dimensioning.axis===`y`?new h(0,0,1):new h(0,1,0)}static _getDefaultLabelDirection(e,t){if(e.axis){let n=v(e.axis.labelDirection);return t.clone().cross(n).cross(t).normalize()}else{if(e.dimensioning.axis===`x`)return new h(0,1,0);if(e.dimensioning.axis===`y`)return new h(-1,0,0)}return new h(-1,0,0)}static _calculateActualLabelDirection(e,t,n){if(t){if(e.axis){if(e.axis.alternativeOrigin)return n.clone().multiplyScalar(-1)}else if(e.dimensioning.axis===`y`||e.dimensioning.axis===`z`)return n.clone().multiplyScalar(-1)}return n}static _calculateOrigin(e,t,n){let r=t.getCenter(new h),i=t.getSize(new h);return e.axis?n&&e.axis.alternativeOrigin?v(e.axis.alternativeOrigin):v(e.axis.origin):e.dimensioning.axis===`x`?new h(0,r.y+i.y*.5,r.z-i.z*.5):e.dimensioning.axis===`y`?new h(r.x+i.x*(n?.5:-.5),r.y-i.y*.5,0):new h(r.x+i.x*(n?.5:-.5),0,r.z-i.z*.5)}},j=class extends i{constructor(e,t,n,r){super(),this.name=p,this._size=t.getSize(new h),this._relativeCameraDirection=r.clone(),this._dimensioning=_(e.dimensioning),this._axis=new A(e,t,r),this._level=this._dimensioning.maxLevel-this._dimensioning.level,this._font=n,this._init()}clone(){console.warn(`Will not clone ComponentDimensioning`)}_initMaterials(){this._cacheHolder.materialCache&&(this._cacheHolder.materialCache.has(S)?this._lineMaterial=this._cacheHolder.materialCache.get(S):(this._lineMaterial=new a({color:D}),this._cacheHolder.materialCache.set(S,this._lineMaterial)),this._cacheHolder.materialCache.has(C)?this._planeMaterial=this._cacheHolder.materialCache.get(C):(this._planeMaterial=new u({color:O,side:2,opacity:.8,transparent:!0}),this._cacheHolder.materialCache.set(C,this._planeMaterial)),this._cacheHolder.materialCache.has(w)?this._textMaterial=this._cacheHolder.materialCache.get(w):(this._textMaterial=new g({color:D}),this._cacheHolder.materialCache.set(w,this._textMaterial)))}_init(){this._initMaterials();let n=new s;this._line=new f(n,this._lineMaterial),this._line.name=`component dimension line `+this._dimensioning.axis,this._text=new o(n,this._textMaterial),this._text.name=`component dimension text `+this._dimensioning.axis,this._plane=new o(n,this._planeMaterial),this._plane.name=`component dimension plane `+this._dimensioning.axis;let r=new s,i=Math.round(Math.max(this._size.y,this._size.x,this._size.z)),a=Math.abs(this._dimensioning.to-this._dimensioning.from),c=E+(i<4?0:i*.005);a<.3&&(c*=.5+a);let l={font:this._font,size:c,height:.001,curveSegments:2,bevelEnabled:!0,bevelThickness:.001,bevelSize:.001,depth:.001},u=new y(this._dimensioning.label?this._dimensioning.label:this._unitFormatter.formatMMValueToUnitString(a*1e3),l);u.computeBoundingBox();let p=u.boundingBox.getSize(new h).y,m=k+(3*T+p)*this._level,g=this._axis.getEdge(this._dimensioning.from,this._dimensioning.to,m);this._addEdgeSideLines(p,g,this._axis.labelDirection.clone());let _=[g.start.x,g.start.y,g.start.z,g.end.x,g.end.y,g.end.z];r.setAttribute(`position`,new d(new Float32Array(_),3)),this._line.geometry.dispose(),this._line.geometry=r,this.add(this._line),this._text.geometry=u;let v=this._axis.direction.clone(),b=this._axis.labelDirection.clone();new h(0,1,0).dot(b)<Math.SQRT1_2&&b.multiplyScalar(-1);let x=v.clone().cross(b),S=new t().makeBasis(v,b,x);this._relativeCameraDirection.dot(x)>0&&(S=S.multiply(new t().makeRotationY(Math.PI)));let C=new e().setFromRotationMatrix(S);this._addText(g,u,C,this._axis.labelDirection.clone().multiplyScalar(2*T))}_addEdgeSideLines(e,t,n){let r=-(3*T+e)*.5,i=t.start.clone(),a=t.start.clone().add(n.clone().multiplyScalar(r)),o=t.end.clone(),s=t.end.clone().add(n.clone().multiplyScalar(r));this._addLine(a,i),this._addLine(s,o)}_addLine(e,t){let n=new s,r=[e.x,e.y,e.z,t.x,t.y,t.z];n.setAttribute(`position`,new d(new Float32Array(r),3)),this.add(new f(n,this._lineMaterial))}_addText(e,t,n,r){let i=e.getCenter(new h);i.add(r);let a=t.boundingBox.getSize(new h);t.center(),this._text.position.copy(i),this._text.quaternion.copy(n),this.add(this._text);let o=new l(a.x+T,a.y+T,32);o.center(),this._plane.geometry=o,this._plane.position.copy(i),this._plane.quaternion.copy(n),this.add(this._plane)}};x([n],j.prototype,`_cacheHolder`),x([n],j.prototype,`_unitFormatter`);export{j as default};