import{r as T,p as D,D as x,l as P,L as R}from"./touch-drag-C1SsZtt4-LcPIoXBL.js";import{i as v,j as I,k as C,R as _,a as E,b as B,c as L,d as M,e as A,f as $,g as b,h as F}from"./drag-in-CYmR1HFI-C_SBxheq.js";import"./index-Bg0OQYY4.js";var N=Object.defineProperty,O=(r,e,t)=>e in r?N(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,g=(r,e,t)=>O(r,typeof e!="symbol"?e+"":e,t);const G=(r,e,t=0,i=0)=>{const o=e.x+e.width+t,s=e.x-t,l=e.y+e.height+i,a=e.y-i,{x:h,y:n}=r;return h>=s&&h<=o&&n>=a&&n<=l},w=(r,e,t,i=0,o=0)=>{if(!(!t||!t.hiddenIn&&!t.visibleIn))return t.visibleIn?G({x:r,y:e},t.visibleIn,i,o):t.hiddenIn?!G({x:r,y:e},t.hiddenIn,-i,-o):!1},k=()=>{if(!document.getElementById(E)){const r=document.createElement("style");r.type="text/css",r.id=E,r.innerHTML=`
    ${B}
    ${L}
  `,document.head.appendChild(r)}},U=({x:r,y:e},t)=>{var i,o,s,l,a,h;let n=document.getElementById(_);if(!n){if(n=document.createElement("div"),(i=t.ghost)!=null&&i.element)n.appendChild(t.ghost.element);else{const d=document.createElement("img");d.src=((o=t.ghost)==null?void 0:o.url)||M,d.width=((s=t.ghost)==null?void 0:s.width)||A,d.height=((l=t.ghost)==null?void 0:l.height)||$,n.appendChild(d)}n.id=_,n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.willChange="transform",n.style.transform="translate3d(0, 0, 0)",n.style.zIndex="9999",n.style.opacity="0.5",w(r,e,t.ghost||{},(a=t.settings)==null?void 0:a.dragInOverlapX,(h=t.settings)==null?void 0:h.dragInOverlapY)||(n.style.display="none"),n.style.pointerEvents="none",document.body.appendChild(n)}},Y=({x:r,y:e},t)=>{var i,o,s,l;const a=document.getElementById(_);if(!a)return;let h=(i=t.ghost)==null?void 0:i.width,n=(o=t.ghost)==null?void 0:o.height;typeof h>"u"&&(h=a.getBoundingClientRect().width||A),typeof n>"u"&&(n=a.getBoundingClientRect().height||$);const d=r-h/2,c=e-n/2;a.style.transform=`translate3d(${d}px, ${c}px, 0)`,t.ghost&&(w(r,e,t.ghost,(s=t.settings)==null?void 0:s.dragInOverlapX,(l=t.settings)==null?void 0:l.dragInOverlapY)?a.style.animation!=b&&(a.style.animation=b):a.style.animation!=F&&(a.style.animation=F))};class q{constructor(e=null){g(this,"_dragGhostAnimationFrameId",null),g(this,"_dragGhostRemoveAnimationFrameId",null),g(this,"_dragGhostElement",null),this._dragGhostElement=e}updateDragGhost(e,t,i){var o;this._dragGhostRemoveAnimationFrameId&&(cancelAnimationFrame(this._dragGhostRemoveAnimationFrameId),this._dragGhostRemoveAnimationFrameId=null),!((o=i.ghost)!=null&&o.external)&&i.ghost&&(this._dragGhostAnimationFrameId||(this._dragGhostAnimationFrameId=requestAnimationFrame(()=>{k();const s={x:e,y:t};!i.ghost&&this._dragGhostElement&&(i.ghost={}),i.ghost&&!i.ghost.element&&this._dragGhostElement&&(i.ghost.element=this._dragGhostElement),U(s,i),Y(s,i),this._dragGhostAnimationFrameId=null})))}removeDragGhost(){this._dragGhostAnimationFrameId&&(cancelAnimationFrame(this._dragGhostAnimationFrameId),this._dragGhostAnimationFrameId=null),this._dragGhostRemoveAnimationFrameId||(this._dragGhostRemoveAnimationFrameId=requestAnimationFrame(()=>{const e=document.getElementById(_);e&&document.body.removeChild(e),this._dragGhostRemoveAnimationFrameId=null}))}}class H{constructor(e,t,i){g(this,"_options",{}),g(this,"_instance"),g(this,"_mainDomElement"),g(this,"_currentDrag",{}),g(this,"_currentTouch",null),g(this,"_firefoxDragPosition",{x:0,y:0}),g(this,"_onBeforeUpdateDrag",()=>({})),g(this,"isDragging",!1),g(this,"_firefoxFallback",o=>{if(!this._currentDrag.event)return;const s=o||window.event;this._firefoxDragPosition.x=s.pageX||0,this._firefoxDragPosition.y=s.pageY||0}),this._instance=e,this._mainDomElement=t,this._options=i||{},this._firefoxFallback=this._firefoxFallback.bind(this),document.addEventListener("dragover",this._firefoxFallback)}beforeUpdateGhost(e){this._onBeforeUpdateDrag=e}dragStart(e,t,i="rml_id"){const o=this._mainDomElement.parentNode;if(T(o).position!=="relative"){console.warn("Parent of iframe should have position relative, otherwise drag-in can not detect the x/y coordinates correctly");return}this._mainDomElement.style.pointerEvents="none";let s=o.querySelector("."+v);s||(s=document.createElement("div"),s.classList.add(v),o.appendChild(s)),s.classList.remove(I.DISPLAY_NONE),t.target.getAttribute("draggable")||console.warn(`Draggable not detected correctly! Did you add draggable="true" to the element? In Sarafi only 'draggable' is too less`);const l=o.querySelector("."+C);this._currentDrag.event=t;const a=t.target,h=a.cloneNode(),n=a.getBoundingClientRect();h.style.width=`${n.width}px`,h.style.height=`${n.height}px`,this._currentDrag.ghost=new q(h),this._currentDrag.offset||(this._currentDrag.offset={x:0,y:0});const{clientX:d,clientY:c}=D(t,this._firefoxDragPosition);this._currentDrag.offset.x=d-n.left,this._currentDrag.offset.y=c-n.top,t instanceof DragEvent&&t.dataTransfer&&t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(l,0,0);const{x:f,y:m}=x(o,this._currentDrag.event||t,this._firefoxDragPosition),p=Math.max(1,f),y=Math.max(1,m);this.isDragging=!0,this._instance.dragInObject(e,p,y,i)}dragUpdate(e){var t;const i=this._mainDomElement.parentNode,{x:o,y:s}=x(i,e,this._firefoxDragPosition);if(o===0&&s===0)return;const l=Math.max(1,o),a=Math.max(1,s);if(l===1&&a===1)return;let h=l,n=a;if(P(e)){const u=((t=this._options.settings)==null?void 0:t.fingerSize)||0;h=Math.max(2,l+u),n=Math.max(2,a-u)}const{x:d,y:c,options:f}=this._onBeforeUpdateDrag(h,n,{}),m=f||{settings:{},ghost:{}};m.ghost||(m.ghost={}),m.ghost.visibleIn&&m.ghost.hiddenIn||(m.ghost.hiddenIn=this._mainDomElement.getBoundingClientRect());const p=typeof d=="number"?d:h,y=typeof c=="number"?c:n;if(this._currentDrag.ghost){const{clientX:u,clientY:S}=D(e,this._firefoxDragPosition);this._currentDrag.ghost.updateDragGhost(u,S,m)}this._instance.updateDrag(p,y,{})}dragEnd(){this._mainDomElement.style.pointerEvents="all";const e=this._mainDomElement.parentNode;this.isDragging=!1,this._instance.dragInObjectEnd(),this._currentDrag.ghost&&(this._currentDrag.ghost.removeDragGhost(),this._currentDrag.ghost=null),this._currentDrag={},this._firefoxDragPosition={x:0,y:0};const t=e.querySelector("."+v);t&&t.classList.add(I.DISPLAY_NONE)}touchStart(e,t,i="rml_id"){var o,s,l,a;t.preventDefault();const h=(d,c)=>{this.dragStart(e,c,i)},n={};typeof((s=(o=this._options)==null?void 0:o.settings)==null?void 0:s.touchDragDelay)=="number"&&(n.delay=this._options.settings.touchDragDelay),(a=(l=this._options)==null?void 0:l.settings)!=null&&a.touchDragEpsilon&&(n.epsilon=this._options.settings.touchDragEpsilon),this._currentTouch=new R(void 0,{onTouchDragStart:h},n),this._currentTouch.onStart(t)}touchMove(e){this._currentTouch&&this._currentTouch.onMove(e),this._currentDrag.event&&this.dragUpdate(e)}touchEnd(){this._currentTouch&&this._currentTouch.onEnd(),this._currentTouch=null,this.dragEnd()}dispose(){document.removeEventListener("dragover",this._firefoxFallback)}releaseInput(e){}}export{H as DragInFromWebsiteStrategy};
