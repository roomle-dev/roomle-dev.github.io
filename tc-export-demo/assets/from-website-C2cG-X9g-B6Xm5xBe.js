var R=Object.defineProperty;var B=(o,e,t)=>e in o?R(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var l=(o,e,t)=>B(o,typeof e!="symbol"?e+"":e,t);import{u as C,X as v,D as x,r as P,O as L}from"./touch-drag-DXJTOrk5-B8mmbwSu.js";import{i as y,j as I,k as M,R as f,a as E,b as N,c as O,d as $,e as A,f as w,g as b,h as G}from"./drag-in-BEjBh6zz-74uoWzvk.js";import"./index-j559rgZ_.js";const F=(o,e,t=0,n=0)=>{const s=e.x+e.width+t,i=e.x-t,g=e.y+e.height+n,h=e.y-n,{x:a,y:r}=o;return a>=i&&a<=s&&r>=h&&r<=g},S=(o,e,t,n=0,s=0)=>{if(!(!t||!t.hiddenIn&&!t.visibleIn))return t.visibleIn?F({x:o,y:e},t.visibleIn,n,s):t.hiddenIn?!F({x:o,y:e},t.hiddenIn,-n,-s):!1},Y=()=>{if(!document.getElementById(E)){const o=document.createElement("style");o.type="text/css",o.id=E,o.innerHTML=`
    ${N}
    ${O}
  `,document.head.appendChild(o)}},k=({x:o,y:e},t)=>{var s,i,g,h,a,r;let n=document.getElementById(f);if(!n){if(n=document.createElement("div"),(s=t.ghost)==null?void 0:s.element)n.appendChild(t.ghost.element);else{const d=document.createElement("img");d.src=((i=t.ghost)==null?void 0:i.url)||$,d.width=((g=t.ghost)==null?void 0:g.width)||A,d.height=((h=t.ghost)==null?void 0:h.height)||w,n.appendChild(d)}n.id=f,n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.willChange="transform",n.style.transform="translate3d(0, 0, 0)",n.style.zIndex="9999",n.style.opacity="0.5",S(o,e,t.ghost||{},(a=t.settings)==null?void 0:a.dragInOverlapX,(r=t.settings)==null?void 0:r.dragInOverlapY)||(n.style.display="none"),n.style.pointerEvents="none",document.body.appendChild(n)}},U=({x:o,y:e},t)=>{var a,r,d,c;const n=document.getElementById(f);if(!n)return;let s=(a=t.ghost)==null?void 0:a.width,i=(r=t.ghost)==null?void 0:r.height;typeof s>"u"&&(s=n.getBoundingClientRect().width||A),typeof i>"u"&&(i=n.getBoundingClientRect().height||w);const g=o-s/2,h=e-i/2;n.style.transform=`translate3d(${g}px, ${h}px, 0)`,t.ghost&&(S(o,e,t.ghost,(d=t.settings)==null?void 0:d.dragInOverlapX,(c=t.settings)==null?void 0:c.dragInOverlapY)?n.style.animation!=b&&(n.style.animation=b):n.style.animation!=G&&(n.style.animation=G))};class X{constructor(e=null){l(this,"_dragGhostAnimationFrameId",null);l(this,"_dragGhostRemoveAnimationFrameId",null);l(this,"_dragGhostElement",null);this._dragGhostElement=e}updateDragGhost(e,t,n){var s;this._dragGhostRemoveAnimationFrameId&&(cancelAnimationFrame(this._dragGhostRemoveAnimationFrameId),this._dragGhostRemoveAnimationFrameId=null),!((s=n.ghost)!=null&&s.external)&&n.ghost&&(this._dragGhostAnimationFrameId||(this._dragGhostAnimationFrameId=requestAnimationFrame(()=>{Y();const i={x:e,y:t};!n.ghost&&this._dragGhostElement&&(n.ghost={}),n.ghost&&!n.ghost.element&&this._dragGhostElement&&(n.ghost.element=this._dragGhostElement),k(i,n),U(i,n),this._dragGhostAnimationFrameId=null})))}removeDragGhost(){this._dragGhostAnimationFrameId&&(cancelAnimationFrame(this._dragGhostAnimationFrameId),this._dragGhostAnimationFrameId=null),this._dragGhostRemoveAnimationFrameId||(this._dragGhostRemoveAnimationFrameId=requestAnimationFrame(()=>{const e=document.getElementById(f);e&&document.body.removeChild(e),this._dragGhostRemoveAnimationFrameId=null}))}}class W{constructor(e,t,n){l(this,"_options",{});l(this,"_instance");l(this,"_mainDomElement");l(this,"_currentDrag",{});l(this,"_currentTouch",null);l(this,"_firefoxDragPosition",{x:0,y:0});l(this,"_onBeforeUpdateDrag",()=>({}));l(this,"isDragging",!1);l(this,"_firefoxFallback",e=>{if(!this._currentDrag.event)return;e.preventDefault();const t=e||window.event;this._firefoxDragPosition.x=t.pageX||0,this._firefoxDragPosition.y=t.pageY||0});var s;this._instance=e,this._mainDomElement=t,this._options=n||{},this._firefoxFallback=this._firefoxFallback.bind(this),document.addEventListener("dragover",this._firefoxFallback),(s=this._mainDomElement.parentElement)==null||s.addEventListener("dragleave",()=>{this._instance.cancelDragIn()})}beforeUpdateGhost(e){this._onBeforeUpdateDrag=e}dragStart(e,t,n="rml_id"){const s=this._mainDomElement.parentNode;if(C(s).position!=="relative"){console.warn("Parent of iframe should have position relative, otherwise drag-in can not detect the x/y coordinates correctly");return}this._mainDomElement.style.pointerEvents="none";let i=s.querySelector("."+y);i||(i=document.createElement("div"),i.classList.add(y),s.appendChild(i)),i.classList.remove(I.DISPLAY_NONE),t.target.getAttribute("draggable")||console.warn(`Draggable not detected correctly! Did you add draggable="true" to the element? In Sarafi only 'draggable' is too less`);const g=s.querySelector("."+M);this._currentDrag.event=t;const h=t.target,a=h.cloneNode(!0),r=h.getBoundingClientRect();a.style.width=`${r.width}px`,a.style.height=`${r.height}px`,this._currentDrag.ghost=new X(a),this._currentDrag.offset||(this._currentDrag.offset={x:0,y:0});const{clientX:d,clientY:c}=v(t,this._firefoxDragPosition);this._currentDrag.offset.x=d-r.left,this._currentDrag.offset.y=c-r.top,t instanceof DragEvent&&t.dataTransfer&&t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(g,0,0);const{x:m,y:p}=x(s,this._currentDrag.event||t,this._firefoxDragPosition),D=Math.max(1,m),u=Math.max(1,p);this.isDragging=!0,this._instance.dragInObject(e,D,u,n)}dragUpdate(e){var u;const t=this._mainDomElement.parentNode,{x:n,y:s}=x(t,e,this._firefoxDragPosition);if(n===0&&s===0)return;const i=Math.max(1,n),g=Math.max(1,s);if(i===1&&g===1)return;let h=i,a=g;if(P(e)){const _=((u=this._options.settings)==null?void 0:u.fingerSize)||0;h=Math.max(2,i+_),a=Math.max(2,g-_)}const{x:r,y:d,options:c}=this._onBeforeUpdateDrag(h,a,{}),m=c||{settings:{},ghost:{}};m.ghost||(m.ghost={}),m.ghost.visibleIn&&m.ghost.hiddenIn||(m.ghost.hiddenIn=this._mainDomElement.getBoundingClientRect());const p=typeof r=="number"?r:h,D=typeof d=="number"?d:a;if(this._currentDrag.ghost){const{clientX:_,clientY:T}=v(e,this._firefoxDragPosition);this._currentDrag.ghost.updateDragGhost(_,T,m)}this._instance.updateDrag(p,D,{})}dragEnd(){this._mainDomElement.style.pointerEvents="all";const e=this._mainDomElement.parentNode;this.isDragging=!1,this._instance.dragInObjectEnd(),this._currentDrag.ghost&&(this._currentDrag.ghost.removeDragGhost(),this._currentDrag.ghost=null),this._currentDrag={},this._firefoxDragPosition={x:0,y:0};const t=e.querySelector("."+y);t&&t.classList.add(I.DISPLAY_NONE)}touchStart(e,t,n="rml_id"){var g,h,a,r;t.preventDefault();const s=(d,c)=>{this.dragStart(e,c,n)},i={};typeof((h=(g=this._options)==null?void 0:g.settings)==null?void 0:h.touchDragDelay)=="number"&&(i.delay=this._options.settings.touchDragDelay),(r=(a=this._options)==null?void 0:a.settings)!=null&&r.touchDragEpsilon&&(i.epsilon=this._options.settings.touchDragEpsilon),this._currentTouch=new L(void 0,{onTouchDragStart:s},i),this._currentTouch.onStart(t)}touchMove(e){this._currentTouch&&this._currentTouch.onMove(e),this._currentDrag.event&&this.dragUpdate(e)}touchEnd(){this._currentTouch&&this._currentTouch.onEnd(),this._currentTouch=null,this.dragEnd()}dispose(){document.removeEventListener("dragover",this._firefoxFallback)}releaseInput(e){}}export{W as DragInFromWebsiteStrategy};
