import{aT as Ct,cH as Rt,b8 as ut,ag as Ft,ad as Et,ae as d,dh as ct,af as Ht,aS as mt,aI as ft,bG as yt,bB as bt,a$ as St,bU as xt,cP as Mt,cY as P,az as C,d4 as W,di as st,aD as K,de as wt,bw as Zt,df as F,dg as m,dd as vt,b6 as rt,bu as Tt,bv as It,dj as Xt}from"./index-CBKByVQi.js";const O=new d,nt=new d,L=new d,H=new d,at=new d,$=new d,ot=new d;class jt{constructor(t=new d,i=new d(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,O)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const e=i.dot(this.direction);return e<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,e)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=O.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(O.copy(this.origin).addScaledVector(this.direction,i),O.distanceToSquared(t))}distanceSqToSegment(t,i,e,s){nt.copy(t).add(i).multiplyScalar(.5),L.copy(i).sub(t).normalize(),H.copy(this.origin).sub(nt);const r=t.distanceTo(i)*.5,a=-this.direction.dot(L),h=H.dot(this.direction),n=-H.dot(L),o=H.lengthSq(),u=Math.abs(1-a*a);let c,l,g,b;if(u>0)if(c=a*n-h,l=a*h-n,b=r*u,c>=0)if(l>=-b)if(l<=b){const x=1/u;c*=x,l*=x,g=c*(c+a*l+2*h)+l*(a*c+l+2*n)+o}else l=r,c=Math.max(0,-(a*l+h)),g=-c*c+l*(l+2*n)+o;else l=-r,c=Math.max(0,-(a*l+h)),g=-c*c+l*(l+2*n)+o;else l<=-b?(c=Math.max(0,-(-a*r+h)),l=c>0?-r:Math.min(Math.max(-r,-n),r),g=-c*c+l*(l+2*n)+o):l<=b?(c=0,l=Math.min(Math.max(-r,-n),r),g=l*(l+2*n)+o):(c=Math.max(0,-(a*r+h)),l=c>0?r:Math.min(Math.max(-r,-n),r),g=-c*c+l*(l+2*n)+o);else l=a>0?-r:r,c=Math.max(0,-(a*l+h)),g=-c*c+l*(l+2*n)+o;return e&&e.copy(this.origin).addScaledVector(this.direction,c),s&&s.copy(nt).addScaledVector(L,l),g}intersectSphere(t,i){O.subVectors(t.center,this.origin);const e=O.dot(this.direction),s=O.dot(O)-e*e,r=t.radius*t.radius;if(s>r)return null;const a=Math.sqrt(r-s),h=e-a,n=e+a;return n<0?null:h<0?this.at(n,i):this.at(h,i)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const e=-(this.origin.dot(t.normal)+t.constant)/i;return e>=0?e:null}intersectPlane(t,i){const e=this.distanceToPlane(t);return e===null?null:this.at(e,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let e,s,r,a,h,n;const o=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,l=this.origin;return o>=0?(e=(t.min.x-l.x)*o,s=(t.max.x-l.x)*o):(e=(t.max.x-l.x)*o,s=(t.min.x-l.x)*o),u>=0?(r=(t.min.y-l.y)*u,a=(t.max.y-l.y)*u):(r=(t.max.y-l.y)*u,a=(t.min.y-l.y)*u),e>a||r>s||((r>e||isNaN(e))&&(e=r),(a<s||isNaN(s))&&(s=a),c>=0?(h=(t.min.z-l.z)*c,n=(t.max.z-l.z)*c):(h=(t.max.z-l.z)*c,n=(t.min.z-l.z)*c),e>n||h>s)||((h>e||e!==e)&&(e=h),(n<s||s!==s)&&(s=n),s<0)?null:this.at(e>=0?e:s,i)}intersectsBox(t){return this.intersectBox(t,O)!==null}intersectTriangle(t,i,e,s,r){at.subVectors(i,t),$.subVectors(e,t),ot.crossVectors(at,$);let a=this.direction.dot(ot),h;if(a>0){if(s)return null;h=1}else if(a<0)h=-1,a=-a;else return null;H.subVectors(this.origin,t);const n=h*this.direction.dot($.crossVectors(H,$));if(n<0)return null;const o=h*this.direction.dot(at.cross(H));if(o<0||n+o>a)return null;const u=-h*H.dot(ot);return u<0?null:this.at(u/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}function Pt(p){for(let t=p.length-1;t>=0;--t)if(p[t]>=65535)return!0;return!1}function Jt(p){return document.createElementNS("http://www.w3.org/1999/xhtml",p)}function _t(){const p=Jt("canvas");return p.style.display="block",p}const At={};function Bt(p){p in At||(At[p]=!0,console.warn(p))}const kt=new ut().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),zt=new ut().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Wt(){const p={enabled:!0,workingColorSpace:vt,spaces:{},convert:function(s,r,a){return this.enabled===!1||r===a||!r||!a||(this.spaces[r].transfer===rt&&(s.r=q(s.r),s.g=q(s.g),s.b=q(s.b)),this.spaces[r].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===rt&&(s.r=Y(s.r),s.g=Y(s.g),s.b=Y(s.b))),s},workingToColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},colorSpaceToWorking:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===It?Tt:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,a){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,r){return Bt("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),p.workingToColorSpace(s,r)},toWorkingColorSpace:function(s,r){return Bt("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),p.colorSpaceToWorking(s,r)}},t=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],e=[.3127,.329];return p.define({[vt]:{primaries:t,whitePoint:e,transfer:Tt,toXYZ:kt,fromXYZ:zt,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:C},outputColorSpaceConfig:{drawingBufferColorSpace:C}},[C]:{primaries:t,whitePoint:e,transfer:rt,toXYZ:kt,fromXYZ:zt,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:C}}}),p}const z=Wt();function q(p){return p<.04045?p*.0773993808:Math.pow(p*.9478672986+.0521327014,2.4)}function Y(p){return p<.0031308?p*12.92:1.055*Math.pow(p,.41666)-.055}const Nt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Z={h:0,s:0,l:0},j={h:0,s:0,l:0};function ht(p,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?p+(t-p)*6*i:i<1/2?t:i<2/3?p+(t-p)*6*(2/3-i):p}class pt{constructor(t,i,e){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,e)}set(t,i,e){if(i===void 0&&e===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,i,e);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=C){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,z.colorSpaceToWorking(this,i),this}setRGB(t,i,e,s=z.workingColorSpace){return this.r=t,this.g=i,this.b=e,z.colorSpaceToWorking(this,s),this}setHSL(t,i,e,s=z.workingColorSpace){if(t=Xt(t,1),i=W(i,0,1),e=W(e,0,1),i===0)this.r=this.g=this.b=e;else{const r=e<=.5?e*(1+i):e+i-e*i,a=2*e-r;this.r=ht(a,r,t+1/3),this.g=ht(a,r,t),this.b=ht(a,r,t-1/3)}return z.colorSpaceToWorking(this,s),this}setStyle(t,i=C){function e(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const a=s[1],h=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return e(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,i);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return e(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,i);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return e(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(r,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=C){const e=Nt[t.toLowerCase()];return e!==void 0?this.setHex(e,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=q(t.r),this.g=q(t.g),this.b=q(t.b),this}copyLinearToSRGB(t){return this.r=Y(t.r),this.g=Y(t.g),this.b=Y(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=C){return z.workingToColorSpace(M.copy(this),t),Math.round(W(M.r*255,0,255))*65536+Math.round(W(M.g*255,0,255))*256+Math.round(W(M.b*255,0,255))}getHexString(t=C){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=z.workingColorSpace){z.workingToColorSpace(M.copy(this),i);const e=M.r,s=M.g,r=M.b,a=Math.max(e,s,r),h=Math.min(e,s,r);let n,o;const u=(h+a)/2;if(h===a)n=0,o=0;else{const c=a-h;switch(o=u<=.5?c/(a+h):c/(2-a-h),a){case e:n=(s-r)/c+(s<r?6:0);break;case s:n=(r-e)/c+2;break;case r:n=(e-s)/c+4;break}n/=6}return t.h=n,t.s=o,t.l=u,t}getRGB(t,i=z.workingColorSpace){return z.workingToColorSpace(M.copy(this),i),t.r=M.r,t.g=M.g,t.b=M.b,t}getStyle(t=C){z.workingToColorSpace(M.copy(this),t);const i=M.r,e=M.g,s=M.b;return t!==C?`color(${t} ${i.toFixed(3)} ${e.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(e*255)},${Math.round(s*255)})`}offsetHSL(t,i,e){return this.getHSL(Z),this.setHSL(Z.h+t,Z.s+i,Z.l+e)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,e){return this.r=t.r+(i.r-t.r)*e,this.g=t.g+(i.g-t.g)*e,this.b=t.b+(i.b-t.b)*e,this}lerpHSL(t,i){this.getHSL(Z),t.getHSL(j);const e=st(Z.h,j.h,i),s=st(Z.s,j.s,i),r=st(Z.l,j.l,i);return this.setHSL(e,s,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,e=this.g,s=this.b,r=t.elements;return this.r=r[0]*i+r[3]*e+r[6]*s,this.g=r[1]*i+r[4]*e+r[7]*s,this.b=r[2]*i+r[5]*e+r[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const M=new pt;pt.NAMES=Nt;let qt=0;class Qt extends Ct{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:qt++}),this.uuid=Rt(),this.name="",this.type="Material",this.blending=mt,this.side=ft,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=yt,this.blendDst=bt,this.blendEquation=St,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new pt(0,0,0),this.blendAlpha=0,this.depthFunc=xt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=P,this.stencilZFail=P,this.stencilZPass=P,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const e=t[i];if(e===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const s=this[i];if(s===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(e):s&&s.isVector3&&e&&e.isVector3?s.copy(e):this[i]=e}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const e={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.color&&this.color.isColor&&(e.color=this.color.getHex()),this.roughness!==void 0&&(e.roughness=this.roughness),this.metalness!==void 0&&(e.metalness=this.metalness),this.sheen!==void 0&&(e.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(e.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(e.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(e.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(e.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(e.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(e.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(e.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(e.shininess=this.shininess),this.clearcoat!==void 0&&(e.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(e.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(e.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(e.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(e.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,e.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(e.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(e.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(e.dispersion=this.dispersion),this.iridescence!==void 0&&(e.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(e.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(e.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(e.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(e.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(e.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(e.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(e.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(e.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(e.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(e.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(e.lightMap=this.lightMap.toJSON(t).uuid,e.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(e.aoMap=this.aoMap.toJSON(t).uuid,e.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(e.bumpMap=this.bumpMap.toJSON(t).uuid,e.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(e.normalMap=this.normalMap.toJSON(t).uuid,e.normalMapType=this.normalMapType,e.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(e.displacementMap=this.displacementMap.toJSON(t).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(e.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(e.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(e.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(e.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(e.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(e.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(e.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(e.combine=this.combine)),this.envMapRotation!==void 0&&(e.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(e.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(e.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(e.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(e.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(e.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(e.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(e.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(e.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(e.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(e.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(e.size=this.size),this.shadowSide!==null&&(e.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(e.sizeAttenuation=this.sizeAttenuation),this.blending!==mt&&(e.blending=this.blending),this.side!==ft&&(e.side=this.side),this.vertexColors===!0&&(e.vertexColors=!0),this.opacity<1&&(e.opacity=this.opacity),this.transparent===!0&&(e.transparent=!0),this.blendSrc!==yt&&(e.blendSrc=this.blendSrc),this.blendDst!==bt&&(e.blendDst=this.blendDst),this.blendEquation!==St&&(e.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(e.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(e.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(e.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(e.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(e.blendAlpha=this.blendAlpha),this.depthFunc!==xt&&(e.depthFunc=this.depthFunc),this.depthTest===!1&&(e.depthTest=this.depthTest),this.depthWrite===!1&&(e.depthWrite=this.depthWrite),this.colorWrite===!1&&(e.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(e.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Mt&&(e.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(e.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(e.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==P&&(e.stencilFail=this.stencilFail),this.stencilZFail!==P&&(e.stencilZFail=this.stencilZFail),this.stencilZPass!==P&&(e.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(e.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(e.rotation=this.rotation),this.polygonOffset===!0&&(e.polygonOffset=!0),this.polygonOffsetFactor!==0&&(e.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(e.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(e.linewidth=this.linewidth),this.dashSize!==void 0&&(e.dashSize=this.dashSize),this.gapSize!==void 0&&(e.gapSize=this.gapSize),this.scale!==void 0&&(e.scale=this.scale),this.dithering===!0&&(e.dithering=!0),this.alphaTest>0&&(e.alphaTest=this.alphaTest),this.alphaHash===!0&&(e.alphaHash=!0),this.alphaToCoverage===!0&&(e.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(e.premultipliedAlpha=!0),this.forceSinglePass===!0&&(e.forceSinglePass=!0),this.wireframe===!0&&(e.wireframe=!0),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(e.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(e.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(e.flatShading=!0),this.visible===!1&&(e.visible=!1),this.toneMapped===!1&&(e.toneMapped=!1),this.fog===!1&&(e.fog=!1),Object.keys(this.userData).length>0&&(e.userData=this.userData);function s(r){const a=[];for(const h in r){const n=r[h];delete n.metadata,a.push(n)}return a}if(i){const r=s(t.textures),a=s(t.images);r.length>0&&(e.textures=r),a.length>0&&(e.images=a)}return e}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let e=null;if(i!==null){const s=i.length;e=new Array(s);for(let r=0;r!==s;++r)e[r]=i[r].clone()}return this.clippingPlanes=e,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}const E=Yt();function Yt(){const p=new ArrayBuffer(4),t=new Float32Array(p),i=new Uint32Array(p),e=new Uint32Array(512),s=new Uint32Array(512);for(let n=0;n<256;++n){const o=n-127;o<-27?(e[n]=0,e[n|256]=32768,s[n]=24,s[n|256]=24):o<-14?(e[n]=1024>>-o-14,e[n|256]=1024>>-o-14|32768,s[n]=-o-1,s[n|256]=-o-1):o<=15?(e[n]=o+15<<10,e[n|256]=o+15<<10|32768,s[n]=13,s[n|256]=13):o<128?(e[n]=31744,e[n|256]=64512,s[n]=24,s[n|256]=24):(e[n]=31744,e[n|256]=64512,s[n]=13,s[n|256]=13)}const r=new Uint32Array(2048),a=new Uint32Array(64),h=new Uint32Array(64);for(let n=1;n<1024;++n){let o=n<<13,u=0;for(;(o&8388608)===0;)o<<=1,u-=8388608;o&=-8388609,u+=947912704,r[n]=o|u}for(let n=1024;n<2048;++n)r[n]=939524096+(n-1024<<13);for(let n=1;n<31;++n)a[n]=n<<23;a[31]=1199570944,a[32]=2147483648;for(let n=33;n<63;++n)a[n]=2147483648+(n-32<<23);a[63]=3347054592;for(let n=1;n<64;++n)n!==32&&(h[n]=1024);return{floatView:t,uint32View:i,baseTable:e,shiftTable:s,mantissaTable:r,exponentTable:a,offsetTable:h}}function w(p){Math.abs(p)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),p=W(p,-65504,65504),E.floatView[0]=p;const t=E.uint32View[0],i=t>>23&511;return E.baseTable[i]+((t&8388607)>>E.shiftTable[i])}function _(p){const t=p>>10;return E.uint32View[0]=E.mantissaTable[E.offsetTable[t]+(p&1023)]+E.exponentTable[t],E.floatView[0]}const y=new d,Q=new K;let Dt=0;class I{constructor(t,i,e=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Dt++}),this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=e,this.usage=wt,this.updateRanges=[],this.gpuType=Zt,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,e){t*=this.itemSize,e*=i.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=i.array[e+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,e=this.count;i<e;i++)Q.fromBufferAttribute(this,i),Q.applyMatrix3(t),this.setXY(i,Q.x,Q.y);else if(this.itemSize===3)for(let i=0,e=this.count;i<e;i++)y.fromBufferAttribute(this,i),y.applyMatrix3(t),this.setXYZ(i,y.x,y.y,y.z);return this}applyMatrix4(t){for(let i=0,e=this.count;i<e;i++)y.fromBufferAttribute(this,i),y.applyMatrix4(t),this.setXYZ(i,y.x,y.y,y.z);return this}applyNormalMatrix(t){for(let i=0,e=this.count;i<e;i++)y.fromBufferAttribute(this,i),y.applyNormalMatrix(t),this.setXYZ(i,y.x,y.y,y.z);return this}transformDirection(t){for(let i=0,e=this.count;i<e;i++)y.fromBufferAttribute(this,i),y.transformDirection(t),this.setXYZ(i,y.x,y.y,y.z);return this}set(t,i=0){return this.array.set(t,i),this}getComponent(t,i){let e=this.array[t*this.itemSize+i];return this.normalized&&(e=F(e,this.array)),e}setComponent(t,i,e){return this.normalized&&(e=m(e,this.array)),this.array[t*this.itemSize+i]=e,this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=F(i,this.array)),i}setX(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=F(i,this.array)),i}setY(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=F(i,this.array)),i}setZ(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=F(i,this.array)),i}setW(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,e){return t*=this.itemSize,this.normalized&&(i=m(i,this.array),e=m(e,this.array)),this.array[t+0]=i,this.array[t+1]=e,this}setXYZ(t,i,e,s){return t*=this.itemSize,this.normalized&&(i=m(i,this.array),e=m(e,this.array),s=m(s,this.array)),this.array[t+0]=i,this.array[t+1]=e,this.array[t+2]=s,this}setXYZW(t,i,e,s,r){return t*=this.itemSize,this.normalized&&(i=m(i,this.array),e=m(e,this.array),s=m(s,this.array),r=m(r,this.array)),this.array[t+0]=i,this.array[t+1]=e,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==wt&&(t.usage=this.usage),t}}class Vt extends I{constructor(t,i,e){super(new Uint16Array(t),i,e)}}class Ut extends I{constructor(t,i,e){super(new Uint32Array(t),i,e)}}class Kt extends I{constructor(t,i,e){super(new Uint16Array(t),i,e),this.isFloat16BufferAttribute=!0}getX(t){let i=_(this.array[t*this.itemSize]);return this.normalized&&(i=F(i,this.array)),i}setX(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize]=w(i),this}getY(t){let i=_(this.array[t*this.itemSize+1]);return this.normalized&&(i=F(i,this.array)),i}setY(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize+1]=w(i),this}getZ(t){let i=_(this.array[t*this.itemSize+2]);return this.normalized&&(i=F(i,this.array)),i}setZ(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize+2]=w(i),this}getW(t){let i=_(this.array[t*this.itemSize+3]);return this.normalized&&(i=F(i,this.array)),i}setW(t,i){return this.normalized&&(i=m(i,this.array)),this.array[t*this.itemSize+3]=w(i),this}setXY(t,i,e){return t*=this.itemSize,this.normalized&&(i=m(i,this.array),e=m(e,this.array)),this.array[t+0]=w(i),this.array[t+1]=w(e),this}setXYZ(t,i,e,s){return t*=this.itemSize,this.normalized&&(i=m(i,this.array),e=m(e,this.array),s=m(s,this.array)),this.array[t+0]=w(i),this.array[t+1]=w(e),this.array[t+2]=w(s),this}setXYZW(t,i,e,s,r){return t*=this.itemSize,this.normalized&&(i=m(i,this.array),e=m(e,this.array),s=m(s,this.array),r=m(r,this.array)),this.array[t+0]=w(i),this.array[t+1]=w(e),this.array[t+2]=w(s),this.array[t+3]=w(r),this}}class Gt extends I{constructor(t,i,e){super(new Float32Array(t),i,e)}}let Lt=0;const B=new Ft,lt=new Et,J=new d,v=new ct,V=new ct,S=new d;class Ot extends Ct{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Lt++}),this.uuid=Rt(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Pt(t)?Ut:Vt)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,e=0){this.groups.push({start:t,count:i,materialIndex:e})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const e=this.attributes.normal;if(e!==void 0){const r=new ut().getNormalMatrix(t);e.applyNormalMatrix(r),e.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return B.makeRotationFromQuaternion(t),this.applyMatrix4(B),this}rotateX(t){return B.makeRotationX(t),this.applyMatrix4(B),this}rotateY(t){return B.makeRotationY(t),this.applyMatrix4(B),this}rotateZ(t){return B.makeRotationZ(t),this.applyMatrix4(B),this}translate(t,i,e){return B.makeTranslation(t,i,e),this.applyMatrix4(B),this}scale(t,i,e){return B.makeScale(t,i,e),this.applyMatrix4(B),this}lookAt(t){return lt.lookAt(t),lt.updateMatrix(),this.applyMatrix4(lt.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(J).negate(),this.translate(J.x,J.y,J.z),this}setFromPoints(t){const i=this.getAttribute("position");if(i===void 0){const e=[];for(let s=0,r=t.length;s<r;s++){const a=t[s];e.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Gt(e,3))}else{const e=Math.min(t.length,i.count);for(let s=0;s<e;s++){const r=t[s];i.setXYZ(s,r.x,r.y,r.z||0)}t.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ct);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new d(-1/0,-1/0,-1/0),new d(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let e=0,s=i.length;e<s;e++){const r=i[e];v.setFromBufferAttribute(r),this.morphTargetsRelative?(S.addVectors(this.boundingBox.min,v.min),this.boundingBox.expandByPoint(S),S.addVectors(this.boundingBox.max,v.max),this.boundingBox.expandByPoint(S)):(this.boundingBox.expandByPoint(v.min),this.boundingBox.expandByPoint(v.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ht);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new d,1/0);return}if(t){const e=this.boundingSphere.center;if(v.setFromBufferAttribute(t),i)for(let r=0,a=i.length;r<a;r++){const h=i[r];V.setFromBufferAttribute(h),this.morphTargetsRelative?(S.addVectors(v.min,V.min),v.expandByPoint(S),S.addVectors(v.max,V.max),v.expandByPoint(S)):(v.expandByPoint(V.min),v.expandByPoint(V.max))}v.getCenter(e);let s=0;for(let r=0,a=t.count;r<a;r++)S.fromBufferAttribute(t,r),s=Math.max(s,e.distanceToSquared(S));if(i)for(let r=0,a=i.length;r<a;r++){const h=i[r],n=this.morphTargetsRelative;for(let o=0,u=h.count;o<u;o++)S.fromBufferAttribute(h,o),n&&(J.fromBufferAttribute(t,o),S.add(J)),s=Math.max(s,e.distanceToSquared(S))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const e=i.position,s=i.normal,r=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new I(new Float32Array(4*e.count),4));const a=this.getAttribute("tangent"),h=[],n=[];for(let f=0;f<e.count;f++)h[f]=new d,n[f]=new d;const o=new d,u=new d,c=new d,l=new K,g=new K,b=new K,x=new d,R=new d;function U(f,T,A){o.fromBufferAttribute(e,f),u.fromBufferAttribute(e,T),c.fromBufferAttribute(e,A),l.fromBufferAttribute(r,f),g.fromBufferAttribute(r,T),b.fromBufferAttribute(r,A),u.sub(o),c.sub(o),g.sub(l),b.sub(l);const N=1/(g.x*b.y-b.x*g.y);isFinite(N)&&(x.copy(u).multiplyScalar(b.y).addScaledVector(c,-g.y).multiplyScalar(N),R.copy(c).multiplyScalar(g.x).addScaledVector(u,-b.x).multiplyScalar(N),h[f].add(x),h[T].add(x),h[A].add(x),n[f].add(R),n[T].add(R),n[A].add(R))}let X=this.groups;X.length===0&&(X=[{start:0,count:t.count}]);for(let f=0,T=X.length;f<T;++f){const A=X[f],N=A.start,et=A.count;for(let k=N,it=N+et;k<it;k+=3)U(t.getX(k+0),t.getX(k+1),t.getX(k+2))}const D=new d,dt=new d,G=new d,gt=new d;function tt(f){G.fromBufferAttribute(s,f),gt.copy(G);const T=h[f];D.copy(T),D.sub(G.multiplyScalar(G.dot(T))).normalize(),dt.crossVectors(gt,T);const A=dt.dot(n[f])<0?-1:1;a.setXYZW(f,D.x,D.y,D.z,A)}for(let f=0,T=X.length;f<T;++f){const A=X[f],N=A.start,et=A.count;for(let k=N,it=N+et;k<it;k+=3)tt(t.getX(k+0)),tt(t.getX(k+1)),tt(t.getX(k+2))}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let e=this.getAttribute("normal");if(e===void 0)e=new I(new Float32Array(i.count*3),3),this.setAttribute("normal",e);else for(let l=0,g=e.count;l<g;l++)e.setXYZ(l,0,0,0);const s=new d,r=new d,a=new d,h=new d,n=new d,o=new d,u=new d,c=new d;if(t)for(let l=0,g=t.count;l<g;l+=3){const b=t.getX(l+0),x=t.getX(l+1),R=t.getX(l+2);s.fromBufferAttribute(i,b),r.fromBufferAttribute(i,x),a.fromBufferAttribute(i,R),u.subVectors(a,r),c.subVectors(s,r),u.cross(c),h.fromBufferAttribute(e,b),n.fromBufferAttribute(e,x),o.fromBufferAttribute(e,R),h.add(u),n.add(u),o.add(u),e.setXYZ(b,h.x,h.y,h.z),e.setXYZ(x,n.x,n.y,n.z),e.setXYZ(R,o.x,o.y,o.z)}else for(let l=0,g=i.count;l<g;l+=3)s.fromBufferAttribute(i,l+0),r.fromBufferAttribute(i,l+1),a.fromBufferAttribute(i,l+2),u.subVectors(a,r),c.subVectors(s,r),u.cross(c),e.setXYZ(l+0,u.x,u.y,u.z),e.setXYZ(l+1,u.x,u.y,u.z),e.setXYZ(l+2,u.x,u.y,u.z);this.normalizeNormals(),e.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,e=t.count;i<e;i++)S.fromBufferAttribute(t,i),S.normalize(),t.setXYZ(i,S.x,S.y,S.z)}toNonIndexed(){function t(h,n){const o=h.array,u=h.itemSize,c=h.normalized,l=new o.constructor(n.length*u);let g=0,b=0;for(let x=0,R=n.length;x<R;x++){h.isInterleavedBufferAttribute?g=n[x]*h.data.stride+h.offset:g=n[x]*u;for(let U=0;U<u;U++)l[b++]=o[g++]}return new I(l,u,c)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Ot,e=this.index.array,s=this.attributes;for(const h in s){const n=s[h],o=t(n,e);i.setAttribute(h,o)}const r=this.morphAttributes;for(const h in r){const n=[],o=r[h];for(let u=0,c=o.length;u<c;u++){const l=o[u],g=t(l,e);n.push(g)}i.morphAttributes[h]=n}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let h=0,n=a.length;h<n;h++){const o=a[h];i.addGroup(o.start,o.count,o.materialIndex)}return i}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const n=this.parameters;for(const o in n)n[o]!==void 0&&(t[o]=n[o]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const e=this.attributes;for(const n in e){const o=e[n];t.data.attributes[n]=o.toJSON(t.data)}const s={};let r=!1;for(const n in this.morphAttributes){const o=this.morphAttributes[n],u=[];for(let c=0,l=o.length;c<l;c++){const g=o[c];u.push(g.toJSON(t.data))}u.length>0&&(s[n]=u,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const h=this.boundingSphere;return h!==null&&(t.data.boundingSphere=h.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const e=t.index;e!==null&&this.setIndex(e.clone());const s=t.attributes;for(const o in s){const u=s[o];this.setAttribute(o,u.clone(i))}const r=t.morphAttributes;for(const o in r){const u=[],c=r[o];for(let l=0,g=c.length;l<g;l++)u.push(c[l].clone(i));this.morphAttributes[o]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let o=0,u=a.length;o<u;o++){const c=a[o];this.addGroup(c.start,c.count,c.materialIndex)}const h=t.boundingBox;h!==null&&(this.boundingBox=h.clone());const n=t.boundingSphere;return n!==null&&(this.boundingSphere=n.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}export{_t as $,Bt as C,Ot as D,I as H,Vt as J,Kt as K,Gt as L,Jt as P,Qt as Q,q as V,Pt as Z,Ut as _,pt as d,jt as j,z as k};
