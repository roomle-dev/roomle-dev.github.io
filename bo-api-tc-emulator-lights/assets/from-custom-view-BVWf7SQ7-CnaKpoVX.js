import{p as b,l as D,L as w,I as v,d as C,b as B,_ as I}from"./touch-drag-C1SsZtt4-LcPIoXBL.js";import{d as u,e as X,f as Y}from"./drag-in-CYmR1HFI-C_SBxheq.js";import"./index-Bg0OQYY4.js";var M=Object.defineProperty,U=(e,t,r)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,i=(e,t,r)=>U(e,typeof t!="symbol"?t+"":t,r);const x=e=>`[data-rml-custom-view="${e}"]`,l=e=>{e.preventDefault(),e.stopPropagation()},L=(e,t,r,s)=>{const a=r-e,n=s-t;return Math.sqrt(a*a+n*n)};class O{constructor({onCustomDragStart:t},r={}){i(this,"_startX",0),i(this,"_startY",0),i(this,"_lastX",0),i(this,"_lastY",0),i(this,"_epsilon"),i(this,"_isWaiting",!1),i(this,"_onCustomDragStart"),this._epsilon=typeof r.epsilon=="number"?r.epsilon:v,this._onCustomDragStart=t}onMove(t){this._lastX=t.clientX,this._lastY=t.clientY,this._isWaiting&&L(this._startX,this._startY,this._lastX,this._lastY)>this._epsilon&&(this._onCustomDragStart(t),this._isWaiting=!1)}onStart(t){this._startX=t.clientX,this._startY=t.clientY,this.onMove(t),this._isWaiting=!0}onEnd(){this._reset()}_reset(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._isWaiting=!1}}const c="data-rml-old-draggable",A=void 0,y=(e,t)=>{const r=D(e),s={delay:r?C:B,epsilon:r?I:v};if(!t)return s;if(!r&&!(e instanceof MouseEvent))return console.warn("Unsupported event! It is not TouchEvent and also not MouseEvent"),s;const{delayKey:a,epsilonKey:n}=r?{delayKey:"touchDragDelay",epsilonKey:"touchDragEpsilon"}:{delayKey:"customDragDelay",epsilonKey:"customDragEpsilon"};return typeof t[a]=="number"&&(s.delay=t.touchDragDelay),typeof t[n]=="number"&&(s.epsilon=t.touchDragEpsilon),s},K=e=>{let t="",r=X,s=Y;if(!e)return{url:u,width:r,height:s};const a=e;if(a instanceof HTMLElement){const n=a.getBoundingClientRect(),o=a.getAttribute("data-rml-ghost-url"),h=a.getAttribute("data-rml-ghost-width"),g=a.getAttribute("data-rml-ghost-height");o?t=o:!o&&a instanceof HTMLImageElement&&a.src&&(t=a.src),t?(r=n.width,s=n.height):t=u,r=h?parseInt(h,10):r,s=g?parseInt(g,10):s}return{url:t||u,width:r,height:s}};class j{constructor(t,r,s){i(this,"_options",{}),i(this,"_instance"),i(this,"_viewName"),i(this,"_currentCustomDrag",null),i(this,"_currentBb",null),i(this,"_startTarget",null),i(this,"_onBeforeUpdateDrag",()=>({})),i(this,"isDragging",!1),this._instance=t,this._options=r||{},this._viewName=s}beforeUpdateGhost(t){this._onBeforeUpdateDrag=t}async _dragStart(t,r,s="rml_id"){this._startTarget&&(this._startTarget.style.pointerEvents="none",this._startTarget.style.userSelect="none",this._startTarget.setAttribute(c,this._startTarget.draggable.toString()),this._startTarget.draggable=!1,this._startTarget.removeEventListener("dragstart",l),this._startTarget.addEventListener("dragstart",l)),this._currentBb=await this._instance.getBoundingClientRect(x(this._viewName));const{clientX:a,clientY:n}=b(r),o=this._currentBb.x+a,h=this._currentBb.y+n;this.isDragging=!0,this._instance.dragInObject(t,o,h,s)}_dragUpdate(t){if(document.body.focus(),this._currentCustomDrag&&this._currentCustomDrag.onMove(t),!this._currentBb||!this.isDragging)return;const{clientX:r,clientY:s}=b(t),{url:a,width:n,height:o}=K(this._startTarget),h=this._currentBb.x+r,g=this._currentBb.y+s,_=this._options||{},d={ghost:{visibleIn:{x:this._currentBb.x-(_.dragInOverlapX||0),y:this._currentBb.y+(_.dragInOverlapY||0),width:this._currentBb.width+(_.dragInOverlapX||0),height:this._currentBb.height+(_.dragInOverlapY||0)},url:a,width:n,height:o},mode:"custom-view"},{x:p,y:m,options:f}=this._onBeforeUpdateDrag(h,g,d),T=typeof p=="number"?p:h,E=typeof m=="number"?m:g,S=f||d;this._instance.updateDrag(T,E,S)}_dragEnd(){this._currentCustomDrag&&this._currentCustomDrag.onEnd(),this._currentCustomDrag=null,this.isDragging=!1,this._currentBb=null,this._resetStartTarget(),this._instance.enableEvents(),this._instance.dragInObjectEnd()}dragStart(t,r,s){this._instance.disableEvents(),this._startTarget=r.target;const a=(n,o)=>{this._dragStart(t,o,s)};this._currentCustomDrag=D(r)?new w(A,{onTouchDragStart:a},y(r,this._options)):new O({onCustomDragStart:n=>this._dragStart(t,n,s)},y(r,this._options)),this._currentCustomDrag.onStart(r)}dragEnd(){this._dragEnd()}dragUpdate(t){this._dragUpdate(t)}touchStart(t,r,s="rml_id"){this.dragStart(t,r,s)}touchMove(t){this.dragUpdate(t)}touchEnd(){this.dragEnd()}dispose(){}_resetStartTarget(){this._startTarget&&(this._startTarget.style.pointerEvents="",this._startTarget.style.userSelect="",this._startTarget.draggable=this._startTarget.getAttribute(c)==="true",this._startTarget.removeAttribute(c),this._startTarget.removeEventListener("dragstart",l))}releaseInput(t){this._currentCustomDrag&&this._currentCustomDrag.onEnd(),this._resetStartTarget()}}export{j as DragInFromCustomViewStrategy};
